<div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column; background-color: #eef2f7;">
  <div style="text-align: center; margin-bottom: 20px;">
    <img src="img/logo.png" alt="Logo" style="max-width: 150px;">
  </div>
  <h2 style="text-align: center; color: #2c3e50;">Registro</h2>
  <form id="registerForm" style="max-width: 400px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); box-sizing: border-box; text-align: center;">
    <input type="text" placeholder="Nombre" id="name" required style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;">
    <input type="email" placeholder="Correo" id="email" required style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;">
    <input type="password" placeholder="Contraseña" id="password" required style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;">
    <button type="submit" style="width: 100%; background-color: #1abc9c; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer;">Registrarse</button>
  </form>
</div>

<script>
document.getElementById('registerForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = e.target.querySelector('button');
  btn.disabled = true;

  const data = {
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    password: document.getElementById('password').value
  };

  try {
    // Usa la ruta correcta
    const res = await fetch('/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await res.json();

    if (res.ok) {
      alert(result.message || 'Registro exitoso');
      // Guarda algo mínimo opcionalmente
      const user = { id: result.userId ?? null, name: data.name, role: 'USER' };
      localStorage.setItem('user', JSON.stringify(user));

      const params = new URLSearchParams(window.location.search);
      const next = params.get('next') || '/';
      window.location.href = next;
    } else {
      alert(result.error || 'Error al registrar');
    }
  } catch (err) {
    console.error('Error en fetch:', err);
    alert('No se pudo conectar con el servidor');
  } finally {
    btn.disabled = false;
  }
});
</script>


